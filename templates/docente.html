<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Docente</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      padding: 50px;
    }

    h2 {
      text-align: center;
    }

    form {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 420px;
      margin: auto;
    }

    label {
      font-weight: bold;
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
    }

    button {
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #218838;
    }

    .mensaje {
      text-align: center;
      color: red;
      font-weight: bold;
    }
  </style>
</head>

<body>

<h2>Panel Docente – Registro de Calificaciones</h2>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% for category, message in messages %}
    <p class="mensaje">{{ message }}</p>
  {% endfor %}
{% endwith %}

<form method="post">

  <!-- GRADO -->
  <label>Grado:</label>
  <select name="grado" required>
    <option value="">Seleccione grado</option>
    {% for grado in grados %}
      <option value="{{ grado }}"
        {% if request.form.get('grado') == grado %}selected{% endif %}>
        {{ grado }}
      </option>
    {% endfor %}
  </select>

  {% if request.form.get('grado') %}

    {% set lista_materias = materias_por_grado.get(request.form.get('grado'), []) %}
    {% set lista_alumnos = alumnos_por_grado.get(request.form.get('grado'), []) %}

    {% if lista_materias %}

      <!-- MATERIA -->
      <label>Materia:</label>
      <select name="materia_id" required>
        <option value="">Seleccione materia</option>
        {% for materia in lista_materias %}
          <option value="{{ materia.id }}"
            {% if request.form.get('materia_id') == materia.id|string %}selected{% endif %}>
            {{ materia.nombre }}
          </option>
        {% endfor %}
      </select>

      <!-- ALUMNO -->
      <label>Alumno:</label>
      <select name="nombre" required>
        <option value="">Seleccione alumno</option>
        {% for alumno in lista_alumnos %}
          <option value="{{ alumno.nombre }}"
            {% if request.form.get('nombre') == alumno.nombre %}selected{% endif %}>
            {{ alumno.nombre }}
          </option>
        {% endfor %}
      </select>

      <!-- BLOQUE -->
      <label>Bloque:</label>
      <select name="bloque" required>
        <option value="">Seleccione bloque</option>
        {% for b in ['1','2','3','4'] %}
          <option value="{{ b }}"
            {% if request.form.get('bloque') == b %}selected{% endif %}>
            Bloque {{ b }}
          </option>
        {% endfor %}
      </select>

      <!-- PUNTAJE -->
      <label>Puntaje:</label>
      <input type="number" name="puntaje"
             value="{{ request.form.get('puntaje','') }}"
             min="0" max="100" step="0.01" required>

      <button type="submit">Registrar Nota</button>

    {% else %}
      <p class="mensaje">No hay materias asignadas a este grado.</p>
    {% endif %}

  {% endif %}

</form>

<br>
<div style="text-align:center;">
  <a href="{{ url_for('logout') }}">Cerrar sesión</a>
</div>

<script>
document.querySelector('select[name="grado"]').addEventListener('change', function () {

  const grado = this.value;

  if (!grado) return;

  fetch(`/ajax/alumnos_materias?grado=${encodeURIComponent(grado)}`)
    .then(response => response.json())
    .then(data => {

      const materiaSelect = document.querySelector('select[name="materia_id"]');
      const alumnoSelect = document.querySelector('select[name="nombre"]');

      materiaSelect.innerHTML = '<option value="">Seleccione materia</option>';
      alumnoSelect.innerHTML = '<option value="">Seleccione alumno</option>';

      data.materias.forEach(m => {
        materiaSelect.innerHTML += `<option value="${m.id}">${m.nombre}</option>`;
      });

      data.alumnos.forEach(a => {
        alumnoSelect.innerHTML += `<option value="${a}">${a}</option>`;
      });
    });
});
</script>


</body>
</html>







